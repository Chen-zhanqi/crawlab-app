(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-591be4e4"],{"0b5e":function(e,t,i){"use strict";var s=i("e3c4"),a=i.n(s);a.a},"138e":function(e,t,i){},"30a6":function(e,t,i){"use strict";var s=i("138e"),a=i.n(s);a.a},"34d9":function(e,t,i){"use strict";var s=i("8216"),a=i("be57");e.exports=s("Set",(function(e){return function(){return e(this,arguments.length?arguments[0]:void 0)}}),a)},5184:function(e,t,i){"use strict";var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"legend"},[i("el-tag",{attrs:{type:"primary",size:"small"}},[i("i",{staticClass:"el-icon-loading"}),e._v(" "+e._s(e.$t("Pending"))+" ")]),i("el-tag",{attrs:{type:"warning",size:"small"}},[i("i",{staticClass:"el-icon-loading"}),e._v(" "+e._s(e.$t("Running"))+" ")]),i("el-tag",{attrs:{type:"success",size:"small"}},[i("i",{staticClass:"el-icon-check"}),e._v(" "+e._s(e.$t("Finished"))+" ")]),i("el-tag",{attrs:{type:"danger",size:"small"}},[i("i",{staticClass:"el-icon-error"}),e._v(" "+e._s(e.$t("Error"))+" ")]),i("el-tag",{attrs:{type:"info",size:"small"}},[i("i",{staticClass:"el-icon-video-pause"}),e._v(" "+e._s(e.$t("Cancelled"))+" ")]),i("el-tag",{attrs:{type:"danger",size:"small"}},[i("i",{staticClass:"el-icon-warning"}),e._v(" "+e._s(e.$t("Abnormal"))+" ")])],1)},a=[],r={name:"StatusLegend"},n=r,o=(i("c734"),i("9ca4")),l=Object(o["a"])(n,s,a,!1,null,"57985e9e",null);t["a"]=l.exports},a316:function(e,t,i){"use strict";i.r(t);var s=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"app-container"},[i("v-tour",{attrs:{name:"spider-list",steps:e.tourSteps,callbacks:e.tourCallbacks,options:e.$utils.tour.getOptions(!0)}}),i("v-tour",{attrs:{name:"spider-list-add",steps:e.tourAddSteps,callbacks:e.tourAddCallbacks,options:e.$utils.tour.getOptions(!0)}}),i("el-dialog",{attrs:{title:e.$t("Add Spider"),width:"40%",visible:e.addDialogVisible,"before-close":e.onAddDialogClose},on:{"update:visible":function(t){e.addDialogVisible=t}}},[i("el-tabs",{attrs:{"active-name":e.activeTabName}},[i("el-tab-pane",{attrs:{name:"customized",label:e.$t("Customized")}},[i("el-form",{ref:"addCustomizedForm",attrs:{model:e.spiderForm,"inline-message":"","label-width":"120px"}},[i("el-form-item",{attrs:{label:e.$t("Spider Name"),prop:"name",required:""}},[i("el-input",{attrs:{id:"spider-name",placeholder:e.$t("Spider Name"),size:"small"},model:{value:e.spiderForm.name,callback:function(t){e.$set(e.spiderForm,"name",t)},expression:"spiderForm.name"}})],1),i("el-form-item",{attrs:{label:e.$t("Display Name"),prop:"display_name",required:""}},[i("el-input",{attrs:{id:"display-name",placeholder:e.$t("Display Name"),size:"small"},model:{value:e.spiderForm.display_name,callback:function(t){e.$set(e.spiderForm,"display_name",t)},expression:"spiderForm.display_name"}})],1),i("el-form-item",{attrs:{label:e.$t("Project"),prop:"project_id",required:""}},[i("el-select",{attrs:{placeholder:e.$t("Project"),filterable:"",size:"small"},model:{value:e.spiderForm.project_id,callback:function(t){e.$set(e.spiderForm,"project_id",t)},expression:"spiderForm.project_id"}},e._l(e.projectList,(function(e){return i("el-option",{key:e._id,attrs:{value:e._id,label:e.name}})})),1)],1),i("el-form-item",{attrs:{label:e.$t("Execute Command"),prop:"cmd",required:""}},[i("el-input",{attrs:{id:"cmd",placeholder:e.$t("Execute Command"),disabled:e.spiderForm.is_scrapy,size:"small"},model:{value:e.spiderForm.cmd,callback:function(t){e.$set(e.spiderForm,"cmd",t)},expression:"spiderForm.cmd"}})],1),i("el-form-item",{attrs:{label:e.$t("Data Source"),prop:"data_source_id"}},[i("el-select",{attrs:{size:"small",placeholder:e.$t("Data Source"),clearable:""},model:{value:e.spiderForm.data_source_id,callback:function(t){e.$set(e.spiderForm,"data_source_id",t)},expression:"spiderForm.data_source_id"}},[i("el-option",{attrs:{value:"000000000000000000000000",label:e.$t("Default")}}),e._l(e.dataSourceList,(function(e){return i("el-option",{key:e._id,attrs:{value:e._id,label:"["+e.type+"] "+e.host+":"+e.port+"/"+e.database+" ("+(e.username||"no username")+")"}})}))],2)],1),i("el-form-item",{attrs:{label:e.$t("Results"),prop:"col"}},[i("el-input",{attrs:{id:"col",placeholder:e.$t("By default: ")+"results_<spider_name>",size:"small"},model:{value:e.spiderForm.col,callback:function(t){e.$set(e.spiderForm,"col",t)},expression:"spiderForm.col"}})],1),i("el-form-item",{attrs:{label:e.$t("Upload Zip File"),"label-width":"120px",name:"site"}},[i("el-upload",{attrs:{action:e.$request.baseUrl+"/spiders",data:e.uploadForm,headers:{Authorization:e.token},"on-success":e.onUploadSuccess,"file-list":e.fileList,"before-upload":e.beforeUpload,size:"small"}},[i("el-button",{attrs:{id:"upload",size:"small",type:"primary",icon:"el-icon-upload"}},[e._v(" "+e._s(e.$t("Upload"))+" ")])],1)],1),i("el-row",[i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:e.$t("Is Scrapy"),prop:"is_scrapy"}},[i("el-switch",{attrs:{"active-color":"#13ce66"},on:{change:e.onIsScrapy},model:{value:e.spiderForm.is_scrapy,callback:function(t){e.$set(e.spiderForm,"is_scrapy",t)},expression:"spiderForm.is_scrapy"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:e.$t("Is Git"),prop:"is_git"}},[i("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.spiderForm.is_git,callback:function(t){e.$set(e.spiderForm,"is_git",t)},expression:"spiderForm.is_git"}})],1)],1),i("el-col",{attrs:{span:8}},[i("el-form-item",{attrs:{label:e.$t("Is Long Task"),prop:"is_long_task"}},[i("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.spiderForm.is_long_task,callback:function(t){e.$set(e.spiderForm,"is_long_task",t)},expression:"spiderForm.is_long_task"}})],1)],1)],1)],1),i("el-alert",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"warning",closable:!1}},[i("p",[e._v(e._s(e.$t('You can click "Add" to create an empty spider and upload files later.')))]),i("p",[e._v(e._s(e.$t('OR, you can also click "Upload" and upload a zip file containing your spider project.')))]),i("p",[i("i",{staticClass:"fa fa-exclamation-triangle"}),e._v(" "+e._s(e.$t("NOTE: When uploading a zip file, please zip your spider files from the ROOT DIRECTORY."))+" ")]),i("p",{staticStyle:{"font-weight":"bolder"}},["en"===e.lang?[e._v(" Recommend uploading spiders using "),i("a",{staticStyle:{color:"#409eff","font-weight":"bolder"},attrs:{href:"https://docs.crawlab.cn/SDK/CLI.html",target:"_blank"}},[e._v("CLI Tool")]),e._v(". ")]:"zh"===e.lang?[e._v(" 推荐使用 "),i("a",{staticStyle:{color:"#409eff","font-weight":"bolder"},attrs:{href:"https://docs.crawlab.cn/SDK/CLI.html",target:"_blank"}},[e._v("CLI 工具")]),e._v(" 上传爬虫。 ")]:e._e()],2)]),i("div",{staticClass:"actions"},[i("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.onAddCustomized}},[e._v(e._s(e.$t("Add")))])],1)],1),i("el-tab-pane",{attrs:{name:"configurable",label:e.$t("Configurable")}},[i("el-form",{ref:"addConfigurableForm",attrs:{model:e.spiderForm,"inline-message":"","label-width":"120px"}},[i("el-form-item",{attrs:{label:e.$t("Spider Name"),prop:"name",required:""}},[i("el-input",{attrs:{placeholder:e.$t("Spider Name"),size:"small"},model:{value:e.spiderForm.name,callback:function(t){e.$set(e.spiderForm,"name",t)},expression:"spiderForm.name"}})],1),i("el-form-item",{attrs:{label:e.$t("Display Name"),prop:"display_name",required:""}},[i("el-input",{attrs:{placeholder:e.$t("Display Name"),size:"small"},model:{value:e.spiderForm.display_name,callback:function(t){e.$set(e.spiderForm,"display_name",t)},expression:"spiderForm.display_name"}})],1),i("el-form-item",{attrs:{label:e.$t("Project"),prop:"project_id",required:""}},[i("el-select",{attrs:{placeholder:e.$t("Project"),filterable:"",size:"small"},model:{value:e.spiderForm.project_id,callback:function(t){e.$set(e.spiderForm,"project_id",t)},expression:"spiderForm.project_id"}},e._l(e.projectList,(function(e){return i("el-option",{key:e._id,attrs:{value:e._id,label:e.name}})})),1)],1),i("el-form-item",{attrs:{label:e.$t("Template"),prop:"template",required:""}},[i("el-select",{attrs:{id:"template",value:e.spiderForm.template,placeholder:e.$t("Template"),size:"small"},model:{value:e.spiderForm.template,callback:function(t){e.$set(e.spiderForm,"template",t)},expression:"spiderForm.template"}},e._l(e.templateList,(function(e){return i("el-option",{key:e,attrs:{label:e,value:e}})})),1)],1),i("el-form-item",{attrs:{label:e.$t("Results"),prop:"col",required:""}},[i("el-input",{attrs:{placeholder:e.$t("Results"),size:"small"},model:{value:e.spiderForm.col,callback:function(t){e.$set(e.spiderForm,"col",t)},expression:"spiderForm.col"}})],1)],1),i("div",{staticClass:"actions"},[i("el-button",{attrs:{id:"add",size:"small",type:"primary"},on:{click:e.onAddConfigurable}},[e._v(e._s(e.$t("Add")))])],1)],1)],1)],1),i("el-dialog",{attrs:{visible:e.isRunningTasksDialogVisible,title:e.$t("Latest Tasks")+" ("+e.$t("Spider")+": "+(e.activeSpider?e.activeSpider.name:"")+")",width:"920px"},on:{"update:visible":function(t){e.isRunningTasksDialogVisible=t}}},[i("el-tabs",{model:{value:e.activeSpiderTaskStatus,callback:function(t){e.activeSpiderTaskStatus=t},expression:"activeSpiderTaskStatus"}},[i("el-tab-pane",{attrs:{name:"pending",label:e.$t("Pending")}}),i("el-tab-pane",{attrs:{name:"running",label:e.$t("Running")}}),i("el-tab-pane",{attrs:{name:"finished",label:e.$t("Finished")}}),i("el-tab-pane",{attrs:{name:"error",label:e.$t("Error")}}),i("el-tab-pane",{attrs:{name:"cancelled",label:e.$t("Cancelled")}}),i("el-tab-pane",{attrs:{name:"abnormal",label:e.$t("Abnormal")}})],1),i("el-table",{staticClass:"table",attrs:{data:e.activeNodeList,"header-cell-style":{background:"rgb(48, 65, 86)",color:"white"},border:"","default-expand-all":""}},[i("el-table-column",{attrs:{type:"expand"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("h4",{staticStyle:{margin:"5px 10px"}},[e._v(e._s(e.$t("Tasks")))]),i("el-table",{staticClass:"table",staticStyle:{margin:"5px 10px"},attrs:{data:e.getTasksByNode(t.row),border:"","max-height":"240px"},on:{"row-click":e.onViewTask}},[i("el-table-column",{attrs:{label:e.$t("Create Time"),prop:"create_ts",width:"140px"}}),i("el-table-column",{attrs:{label:e.$t("Start Time"),prop:"start_ts",width:"140px"}}),i("el-table-column",{attrs:{label:e.$t("Finish Time"),prop:"finish_ts",width:"140px"}}),i("el-table-column",{attrs:{label:e.$t("Parameters"),prop:"param",width:"120px"}}),i("el-table-column",{attrs:{label:e.$t("Status"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(e){return[i("status-tag",{attrs:{status:e.row.status}})]}}],null,!0)}),i("el-table-column",{attrs:{label:e.$t("Results Count"),prop:"result_count",width:"80px"}}),i("el-table-column",{attrs:{label:e.$t("Action"),width:"auto"},scopedSlots:e._u([{key:"default",fn:function(t){return[["pending","running"].includes(t.row.status)?i("el-button",{attrs:{type:"danger",size:"mini",icon:"el-icon-video-pause"},on:{click:function(i){return e.onStop(t.row,i)}}}):e._e()]}}],null,!0)})],1)]}}])}),i("el-table-column",{attrs:{label:e.$t("Node"),width:"150px",prop:"name"}}),i("el-table-column",{attrs:{label:e.$t("Status"),width:"120px",prop:"status"},scopedSlots:e._u([{key:"default",fn:function(t){return["offline"===t.row.status?i("el-tag",{attrs:{type:"info"}},[e._v(e._s(e.$t("Offline")))]):"online"===t.row.status?i("el-tag",{attrs:{type:"success"}},[e._v(e._s(e.$t("Online")))]):i("el-tag",{attrs:{type:"danger"}},[e._v(e._s(e.$t("Unavailable")))])]}}])}),i("el-table-column",{attrs:{label:e.$t("Description"),width:"auto",prop:"description"}})],1),i("template",{slot:"footer"},[i("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.isRunningTasksDialogVisible=!1}}},[e._v(e._s(e.$t("Ok")))])],1)],2),i("crawl-confirm-dialog",{attrs:{visible:e.crawlConfirmDialogVisible,"spider-id":e.activeSpiderId,spiders:e.selectedSpiders,multiple:e.isMultiple},on:{close:e.onCrawlConfirmDialogClose,confirm:e.onCrawlConfirm}}),i("copy-spider-dialog",{attrs:{visible:e.copyDialogVisible,"spider-id":e.activeSpiderId},on:{close:function(t){e.copyDialogVisible=!1},confirm:e.onCopyConfirm}}),i("batch-crawl-dialog",{attrs:{visible:e.batchCrawlDialogVisible},on:{close:e.onBatchCrawlDialogClose,confirm:e.onBatchCrawlConfirm}}),i("el-dialog",{attrs:{title:e.$t("Set Projects"),visible:e.setProjectsVisible,"before-close":function(){return e.setProjectsVisible=!1},width:"580px"},on:{"update:visible":function(t){e.setProjectsVisible=t}}},[i("el-form",{ref:"set-projects-form",attrs:{"label-width":"120px",model:e.form}},[i("el-form-item",{attrs:{label:e.$t("Project"),prop:"projectId",required:""}},[i("el-select",{attrs:{size:"small",placeholder:e.$t("Project")},model:{value:e.form.projectId,callback:function(t){e.$set(e.form,"projectId",t)},expression:"form.projectId"}},e._l(e.projectList,(function(e){return i("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})})),1)],1)],1),i("template",{slot:"footer"},[i("el-button",{attrs:{type:"plain",size:"small"},on:{click:function(t){e.setProjectsVisible=!1}}},[e._v(e._s(e.$t("Stop")))]),i("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onSetProjectsConfirm}},[e._v(" "+e._s(e.$t("Confirm"))+" ")])],1)],2),i("el-card",{staticStyle:{"border-radius":"0"}},[i("div",{staticClass:"filter"},[i("div",{staticClass:"left"},[i("el-form",{attrs:{inline:!0}},[i("el-form-item",[i("el-select",{attrs:{size:"small",placeholder:e.$t("Project")},on:{change:e.getList},model:{value:e.filter.project_id,callback:function(t){e.$set(e.filter,"project_id",t)},expression:"filter.project_id"}},[i("el-option",{attrs:{value:"",label:e.$t("All Projects")}}),e._l(e.projectList,(function(e){return i("el-option",{key:e._id,attrs:{value:e._id,label:e.name}})}))],2)],1),i("el-form-item",[i("el-select",{attrs:{size:"small",placeholder:e.$t("Owner Type")},on:{change:e.getList},model:{value:e.filter.owner_type,callback:function(t){e.$set(e.filter,"owner_type",t)},expression:"filter.owner_type"}},[i("el-option",{attrs:{value:"me",label:e.$t("My Spiders")}}),i("el-option",{attrs:{value:"all",label:e.$t("All Spiders")}}),i("el-option",{attrs:{value:"public",label:e.$t("Public Spiders")}})],1)],1),i("el-form-item",[i("el-input",{attrs:{size:"small",placeholder:e.$t("Spider Name"),clearable:""},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.onSearch(t)}},model:{value:e.filter.keyword,callback:function(t){e.$set(e.filter,"keyword",t)},expression:"filter.keyword"}},[i("i",{staticClass:"el-input__icon el-icon-search",attrs:{slot:"suffix"},slot:"suffix"})])],1),i("el-form-item",[i("el-button",{staticClass:"btn refresh",attrs:{size:"small",type:"success"},on:{click:e.onRefresh}},[e._v(" "+e._s(e.$t("Search"))+" ")])],1)],1)],1),i("div",{staticClass:"right"},[i("el-button",{staticClass:"btn add",staticStyle:{"font-weight":"bolder"},attrs:{size:"small",type:"danger",icon:"el-icon-video-play"},on:{click:e.onBatchCrawl}},[e._v(" "+e._s(e.$t("Batch Run"))+" ")]),this.selectedSpiders.length?i("el-button",{staticClass:"btn set-projects",staticStyle:{"font-weight":"bolder"},attrs:{size:"small",type:"primary",icon:"el-icon-s-operation"},on:{click:e.onSetProjects}},[e._v(" "+e._s(e.$t("Set Projects"))+" ")]):e._e(),this.selectedSpiders.length?i("el-button",{staticClass:"btn add",staticStyle:{"font-weight":"bolder"},attrs:{size:"small",type:"info",icon:e.isStopLoading?"el-icon-loading":"el-icon-video-pause"},on:{click:e.onStopSelectedSpiders}},[e._v(" "+e._s(e.$t("Stop"))+" ")]):e._e(),this.selectedSpiders.length?i("el-button",{staticClass:"btn add",staticStyle:{"font-weight":"bolder"},attrs:{size:"small",type:"danger",icon:e.isRemoveLoading?"el-icon-loading":"el-icon-delete"},on:{click:e.onRemoveSelectedSpiders}},[e._v(" "+e._s(e.$t("Remove"))+" ")]):e._e(),i("el-button",{staticClass:"btn add",staticStyle:{"font-weight":"bolder"},attrs:{size:"small",type:"success",icon:"el-icon-plus"},on:{click:e.onAdd}},[e._v(" "+e._s(e.$t("Add Spider"))+" ")])],1)]),i("el-tabs",{staticClass:"tabs",on:{"tab-click":e.onClickTab},model:{value:e.filter.type,callback:function(t){e.$set(e.filter,"type",t)},expression:"filter.type"}},[i("el-tab-pane",{staticClass:"all",attrs:{label:e.$t("All"),name:"all"}}),i("el-tab-pane",{staticClass:"customized",attrs:{label:e.$t("Customized"),name:"customized"}}),i("el-tab-pane",{staticClass:"configurable",attrs:{label:e.$t("Configurable"),name:"configurable"}}),i("el-tab-pane",{staticClass:"long-task",attrs:{label:e.$t("Long Task"),name:"long-task"}})],1),i("status-legend"),i("el-table",{ref:"table",staticClass:"table",attrs:{data:e.spiderList,"header-cell-style":{background:"rgb(48, 65, 86)",color:"white"},border:"","row-key":"_id"},on:{"row-click":e.onRowClick,"sort-change":e.onSortChange,"selection-change":e.onSpiderSelect}},[i("el-table-column",{attrs:{type:"selection",width:"45",align:"center","reserve-selection":""}}),e._l(e.columns,(function(t){return["type"===t.name?i("el-table-column",{key:t.name,attrs:{label:e.$t(t.label),align:"left",width:t.width,sortable:t.sortable},scopedSlots:e._u([{key:"default",fn:function(t){return[e._v(" "+e._s(e.$t(t.row.type))+" ")]}}],null,!0)}):"last_5_errors"===t.name?i("el-table-column",{key:t.name,attrs:{label:e.$t(t.label),width:t.width,sortable:t.sortable,align:"center"},scopedSlots:e._u([{key:"default",fn:function(s){return[i("div",{style:{color:s.row[t.name]>0?"red":""}},[e._v(" "+e._s(s.row[t.name])+" ")])]}}],null,!0)}):"cmd"===t.name?i("el-table-column",{key:t.name,attrs:{label:e.$t(t.label),width:t.width,sortable:t.sortable,align:"left"},scopedSlots:e._u([{key:"default",fn:function(s){return[i("el-input",{model:{value:s.row[t.name],callback:function(i){e.$set(s.row,t.name,i)},expression:"scope.row[col.name]"}})]}}],null,!0)}):t.name.match(/_ts$/)?i("el-table-column",{key:t.name,attrs:{label:e.$t(t.label),sortable:t.sortable,align:t.align,width:t.width},scopedSlots:e._u([{key:"default",fn:function(i){return[e._v(" "+e._s(e.getTime(i.row[t.name]))+" ")]}}],null,!0)}):"last_status"===t.name?i("el-table-column",{key:t.name,attrs:{label:e.$t(t.label),align:"left",width:t.width,sortable:t.sortable},scopedSlots:e._u([{key:"default",fn:function(e){return[i("status-tag",{attrs:{status:e.row.last_status}})]}}],null,!0)}):["is_scrapy","is_long_task"].includes(t.name)?i("el-table-column",{key:t.name,attrs:{label:e.$t(t.label),align:"left",width:t.width,sortable:t.sortable},scopedSlots:e._u([{key:"default",fn:function(s){return["customized"===s.row.type?i("el-switch",{attrs:{"active-color":"#13ce66",disabled:""},model:{value:s.row[t.name],callback:function(i){e.$set(s.row,t.name,i)},expression:"scope.row[col.name]"}}):e._e()]}}],null,!0)}):"latest_tasks"===t.name?i("el-table-column",{key:t.name,attrs:{label:e.$t(t.label),width:t.width,align:t.align,"class-name":"latest-tasks"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.getTaskCountByStatus(t.row,"pending")>0?i("el-tag",{attrs:{type:"primary",size:"small"}},[i("i",{staticClass:"el-icon-loading"}),e._v(" "+e._s(e.getTaskCountByStatus(t.row,"pending"))+" ")]):e._e(),e.getTaskCountByStatus(t.row,"running")>0?i("el-tag",{attrs:{type:"warning",size:"small"}},[i("i",{staticClass:"el-icon-loading"}),e._v(" "+e._s(e.getTaskCountByStatus(t.row,"running"))+" ")]):e._e(),e.getTaskCountByStatus(t.row,"finished")>0?i("el-tag",{attrs:{type:"success",size:"small"}},[i("i",{staticClass:"el-icon-check"}),e._v(" "+e._s(e.getTaskCountByStatus(t.row,"finished"))+" ")]):e._e(),e.getTaskCountByStatus(t.row,"error")>0?i("el-tag",{attrs:{type:"danger",size:"small"}},[i("i",{staticClass:"el-icon-error"}),e._v(" "+e._s(e.getTaskCountByStatus(t.row,"error"))+" ")]):e._e(),e.getTaskCountByStatus(t.row,"cancelled")>0?i("el-tag",{attrs:{type:"info",size:"small"}},[i("i",{staticClass:"el-icon-video-pause"}),e._v(" "+e._s(e.getTaskCountByStatus(t.row,"cancelled"))+" ")]):e._e(),e.getTaskCountByStatus(t.row,"abnormal")>0?i("el-tag",{attrs:{type:"danger",size:"small"}},[i("i",{staticClass:"el-icon-warning"}),e._v(" "+e._s(e.getTaskCountByStatus(t.row,"abnormal"))+" ")]):e._e()]}}],null,!0)}):i("el-table-column",{key:t.name,attrs:{property:t.name,label:e.$t(t.label),sortable:t.sortable,align:t.align||"left",width:t.width}})]})),i("el-table-column",{attrs:{label:e.$t("Action"),align:"left",fixed:"right","min-width":"220px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-tooltip",{attrs:{content:e.$t("View"),placement:"top"}},[i("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini",disabled:e.isDisabled(t.row)},on:{click:function(i){return e.onView(t.row,i)}}})],1),i("el-tooltip",{attrs:{content:e.$t("Remove"),placement:"top"}},[i("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini",disabled:e.isDisabled(t.row)},on:{click:function(i){return e.onRemove(t.row,i)}}})],1),i("el-tooltip",{attrs:{content:e.$t("Copy"),placement:"top"}},[i("el-button",{attrs:{type:"info",icon:"el-icon-copy-document",size:"mini"},on:{click:function(i){return e.onCopy(t.row,i)}}})],1),e.isShowRun(t.row)?i("el-tooltip",{attrs:{content:e.$t("Run"),placement:"top"}},[i("el-button",{attrs:{type:"success",icon:"fa fa-bug",size:"mini",disabled:e.isDisabled(t.row)},on:{click:function(i){return e.onCrawl(t.row,i)}}})],1):i("el-tooltip",{attrs:{content:e.$t("No command line"),placement:"top"}},[i("el-button",{attrs:{disabled:"",type:"success",icon:"fa fa-bug",size:"mini"},on:{click:function(i){return e.onCrawl(t.row,i)}}})],1),i("el-tooltip",{attrs:{content:e.$t("Latest Tasks"),placement:"top"}},[i("el-button",{attrs:{type:"warning",icon:"fa fa-tasks",size:"mini",disabled:e.isDisabled(t.row)},on:{click:function(i){return e.onViewRunningTasks(t.row,i)}}})],1)]}}])})],2),i("div",{staticClass:"pagination"},[i("el-pagination",{attrs:{"current-page":e.pagination.pageNum,"page-sizes":[10,20,50,100],"page-size":e.pagination.pageSize,layout:"sizes, prev, pager, next",total:e.spiderTotal},on:{"update:currentPage":function(t){return e.$set(e.pagination,"pageNum",t)},"update:current-page":function(t){return e.$set(e.pagination,"pageNum",t)},"update:pageSize":function(t){return e.$set(e.pagination,"pageSize",t)},"update:page-size":function(t){return e.$set(e.pagination,"pageSize",t)},"current-change":e.onPageNumChange,"size-change":e.onPageSizeChange}})],1)],1)],1)},a=[],r=(i("dbb3"),i("2eeb"),i("08d5"),i("053b"),i("e18c"),i("e35a"),i("f4e3"),i("1fb3"),i("6a61"),i("cf7f")),n=i("e793"),o=i("9f3a"),l=i("1d45"),c=i.n(l),d=i("1732"),p=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{attrs:{visible:e.visible,width:"1200px","before-close":e.beforeClose}},[i("el-table",{attrs:{data:e.batchCrawlList}},[i("el-table-column",{attrs:{label:e.$t("Spider"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{size:"mini",filterable:"",placeholder:e.$t("Spider")},on:{change:function(i){return e.onSpiderChange(t.row,i)}},model:{value:t.row.spider_id,callback:function(i){e.$set(t.row,"spider_id",i)},expression:"scope.row.spider_id"}},e._l(e.allSpiderList,(function(e){return i("el-option",{key:e._id,attrs:{label:e.display_name+" ("+e.name+")",value:e._id}})})),1)]}}])}),i("el-table-column",{attrs:{label:e.$t("Run Type"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-select",{attrs:{size:"mini"},model:{value:t.row.run_type,callback:function(i){e.$set(t.row,"run_type",i)},expression:"scope.row.run_type"}},[i("el-option",{attrs:{value:"all-nodes",label:e.$t("All Nodes")}}),i("el-option",{attrs:{value:"selected-nodes",label:e.$t("Selected Nodes")}}),i("el-option",{attrs:{value:"random",label:e.$t("Random")}})],1)]}}])}),i("el-table-column",{attrs:{label:e.$t("Nodes"),width:"250px"},scopedSlots:e._u([{key:"default",fn:function(t){return"selected-nodes"===t.row.run_type?[i("el-select",{attrs:{size:"mini",multiple:"",placeholder:e.$t("Nodes")},model:{value:t.row.node_ids,callback:function(i){e.$set(t.row,"node_ids",i)},expression:"scope.row.node_ids"}},e._l(e.activeNodeList,(function(e){return i("el-option",{key:e._id,attrs:{label:e.name,value:e._id}})})),1)]:void 0}}],null,!0)}),i("el-table-column",{attrs:{label:e.$t("Scrapy Spider"),width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return e.getSpiderById(t.row.spider_id).is_scrapy?[i("el-select",{attrs:{size:"mini",placeholder:e.$t("Scrapy Spider"),disabled:!t.row.scrapy_spider_name},model:{value:t.row.scrapy_spider_name,callback:function(i){e.$set(t.row,"scrapy_spider_name",i)},expression:"scope.row.scrapy_spider_name"}},e._l(e.getScrapySpiderNames(t.row.spider_id),(function(e,t){return i("el-option",{key:t,attrs:{label:e,value:e}})})),1)]:void 0}}],null,!0)}),i("el-table-column",{attrs:{label:e.$t("Scrapy Log Level"),width:"120px"},scopedSlots:e._u([{key:"default",fn:function(t){return e.getSpiderById(t.row.spider_id).is_scrapy?[i("el-select",{attrs:{placeholder:e.$t("Scrapy Log Level"),size:"mini"},model:{value:t.row.scrapy_log_level,callback:function(i){e.$set(t.row,"scrapy_log_level",i)},expression:"scope.row.scrapy_log_level"}},[i("el-option",{attrs:{value:"INFO",label:"INFO"}}),i("el-option",{attrs:{value:"DEBUG",label:"DEBUG"}}),i("el-option",{attrs:{value:"WARN",label:"WARN"}}),i("el-option",{attrs:{value:"ERROR",label:"ERROR"}})],1)]:void 0}}],null,!0)}),i("el-table-column",{attrs:{label:e.$t("Parameters"),"min-width":"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-input",{attrs:{size:"mini",placeholder:e.$t("Parameters")},model:{value:t.param,callback:function(i){e.$set(t,"param",i)},expression:"scope.param"}})]}}])}),i("el-table-column",{attrs:{label:e.$t("Action"),fixed:"right",width:"150px"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("el-button",{attrs:{icon:"el-icon-plus",size:"mini",type:"primary"},on:{click:function(i){return e.onAdd(t.$index)}}}),i("el-button",{attrs:{icon:"el-icon-delete",size:"mini",type:"danger"},on:{click:function(i){return e.onRemove(t.$index)}}})]}}])})],1),i("template",{slot:"footer"},[i("el-button",{attrs:{type:"plain",size:"small"},on:{click:function(t){return e.$emit("close")}}},[e._v(e._s(e.$t("Cancel")))]),i("el-button",{attrs:{type:"plain",size:"small"},on:{click:e.reset}},[e._v(" "+e._s(e.$t("Reset"))+" ")]),i("el-button",{attrs:{type:"primary",size:"small",disabled:e.isConfirmDisabled},on:{click:e.onConfirm}},[e._v(" "+e._s(e.$t("Confirm"))+" ")])],1)],2)},u=[],m=(i("b4fb"),i("fe59"),i("98e0"),i("ea69"),i("34d9"),i("96db"),i("08ba"),i("af86"),{name:"BatchCrawlDialog",props:{visible:{type:Boolean,default:!1}},data:function(){return{scrapySpidersNamesDict:{}}},computed:Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(o["c"])("task",["batchCrawlList"])),Object(o["c"])("spider",["allSpiderList"])),Object(o["c"])("node",["nodeList"])),{},{activeNodeList:function(){return this.nodeList.filter((function(e){return"online"===e.status}))},validCrawlList:function(){return this.batchCrawlList.filter((function(e){return!!e.spider_id}))},isConfirmDisabled:function(){if(0===this.validCrawlList.length)return!0;for(var e=0;e<this.validCrawlList.length;e++){var t=this.validCrawlList[e],i=this.getSpiderById(t.spider_id);if(!i)return!0;if(i.is_scrapy&&!t.scrapy_spider_name)return!0}return!1},scrapySpidersIds:function(){var e=this;return Array.from(new Set(this.validCrawlList.filter((function(t){var i=e.getSpiderById(t.spider_id);return i&&i.is_scrapy})).map((function(e){return e.spider_id}))))}}),watch:{visible:function(){this.visible&&this.fetchAllScrapySpiderNames()}},methods:{beforeClose:function(){this.$emit("close")},reset:function(){this.$store.commit("task/SET_BATCH_CRAWL_LIST",[]);for(var e=0;e<10;e++)this.batchCrawlList.push({spider_id:"",run_type:"random",param:"",scrapy_log_level:"INFO"});this.$st.sendEv("批量运行","重置")},getSpiderById:function(e){return this.allSpiderList.filter((function(t){return t._id===e}))[0]||{}},onSpiderChange:function(e,t){var i=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:if(a=i.getSpiderById(t),a){s.next=3;break}return s.abrupt("return");case 3:if(!a.is_scrapy){s.next=7;break}return s.next=6,i.fetchScrapySpiderNames(t);case 6:i.scrapySpidersNamesDict[t]&&i.scrapySpidersNamesDict[t].length>0&&i.$set(e,"scrapy_spider_name",i.scrapySpidersNamesDict[t][0]);case 7:i.$st.sendEv("批量运行","选择爬虫");case 8:case"end":return s.stop()}}),s)})))()},getScrapySpiderNames:function(e){return this.scrapySpidersNamesDict[e]?this.scrapySpidersNamesDict[e]:[]},onConfirm:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$request.put("/tasks/batch",e.validCrawlList.map((function(t){var i=e.getSpiderById(t.spider_id);return"customized"===i.type&&i.is_scrapy&&(t.param="".concat(e.scrapySpidersNamesDict[t.spider_id]?e.scrapySpidersNamesDict[t.spider_id][0]:""," --loglevel=").concat(t.scrapy_log_level," ").concat(t.param||"")),t})));case 2:e.reset(),e.$emit("close"),e.$emit("confirm"),e.$st.sendEv("批量运行","确认批量运行");case 6:case"end":return t.stop()}}),t)})))()},fetchScrapySpiderNames:function(e){var t=this;return Object(r["a"])(regeneratorRuntime.mark((function i(){var s;return regeneratorRuntime.wrap((function(i){while(1)switch(i.prev=i.next){case 0:if(t.scrapySpidersNamesDict[e]){i.next=5;break}return i.next=3,t.$request.get("/spiders/".concat(e,"/scrapy/spiders"));case 3:s=i.sent,t.$set(t.scrapySpidersNamesDict,e,s.data.data);case 5:case"end":return i.stop()}}),i)})))()},fetchAllScrapySpiderNames:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,Promise.all(e.scrapySpidersIds.map(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.fetchScrapySpiderNames(i);case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()));case 2:e.validCrawlList.filter((function(t){var i=e.getSpiderById(t.spider_id);return i&&i.is_scrapy})).forEach((function(t){var i=t.spider_id;e.scrapySpidersNamesDict[i]&&e.scrapySpidersNamesDict[i].length>0&&e.$set(t,"scrapy_spider_name",e.scrapySpidersNamesDict[i][0])}));case 3:case"end":return t.stop()}}),t)})))()},onAdd:function(e){this.batchCrawlList.splice(e+1,0,{spider_id:"",run_type:"random",param:"",scrapy_log_level:"INFO"}),this.$st.sendEv("批量运行","添加")},onRemove:function(e){this.batchCrawlList.splice(e,1),this.$st.sendEv("批量运行","删除")}}}),f=m,h=(i("0b5e"),i("9ca4")),b=Object(h["a"])(f,p,u,!1,null,"1615e6c6",null),g=b.exports,_=i("c91b"),v=i("5184"),y=function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("el-dialog",{ref:"form",staticClass:"copy-spider-dialog",attrs:{title:e.$t("Copy Spider"),visible:e.visible,width:"580px","before-close":e.onClose}},[i("el-form",{ref:"form",attrs:{"label-width":"160px",model:e.form}},[i("el-form-item",{attrs:{label:e.$t("New Spider Name"),required:""}},[i("el-input",{attrs:{placeholder:e.$t("New Spider Name")},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1)],1),i("template",{slot:"footer"},[i("el-button",{attrs:{type:"plain",size:"small"},on:{click:function(t){return e.$emit("close")}}},[e._v(e._s(e.$t("Cancel")))]),i("el-button",{attrs:{type:"primary",size:"small",icon:e.isLoading?"el-icon-loading":"",disabled:e.isLoading},on:{click:e.onConfirm}},[e._v(" "+e._s(e.$t("Confirm"))+" ")])],1)],2)},w=[],$={name:"CopySpiderDialog",props:{spiderId:{type:String,default:""},visible:{type:Boolean,default:!1}},data:function(){return{form:{name:""},isLoading:!1}},methods:{onClose:function(){this.$emit("close")},onConfirm:function(){var e=this;this.$refs["form"].validate(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,e.isLoading=!0,t.next=6,e.$request.post("/spiders/".concat(e.spiderId,"/copy"),e.form);case 6:s=t.sent,s.data.error||e.$message.success("Copied successfully"),e.$emit("confirm"),e.$emit("close"),e.$st.sendEv("爬虫复制","确认提交");case 11:return t.prev=11,e.isLoading=!1,t.finish(11);case 14:case"end":return t.stop()}}),t,null,[[2,,11,14]])})));return function(e){return t.apply(this,arguments)}}())}}},S=$,k=Object(h["a"])(S,y,w,!1,null,"04c020f9",null),C=k.exports,x={name:"SpiderList",components:{CopySpiderDialog:C,StatusLegend:v["a"],CrawlConfirmDialog:d["a"],StatusTag:_["a"],BatchCrawlDialog:g},data:function(){var e=this;return{pagination:{pageNum:1,pageSize:10},importLoading:!1,addConfigurableLoading:!1,isEditMode:!1,dialogVisible:!1,addDialogVisible:!1,crawlConfirmDialogVisible:!1,batchCrawlDialogVisible:!1,setProjectsVisible:!1,isRunningTasksDialogVisible:!1,activeSpiderId:void 0,activeSpider:void 0,filter:{project_id:"",keyword:"",type:"all",owner_type:"me"},sort:{sortKey:"",sortDirection:null},types:[],spiderFormRules:{name:[{required:!0,message:"Required Field",trigger:"change"}]},fileList:[],activeTabName:"customized",tourSteps:[{target:"#tab-customized",content:this.$t("View a list of <strong>Customized Spiders</strong>"),params:{highlight:!1}},{target:"#tab-configurable",content:this.$t("View a list of <strong>Configurable Spiders</strong>"),params:{highlight:!1}},{target:".table",content:this.$t("You can view your created spiders here.<br>Click a table row to view <strong>spider details</strong>."),params:{placement:"top"}},{target:".btn.add",content:this.$t('Click to add a new spider.<br><br>You can also add a <strong>Customized Spider</strong> through <a href="https://docs.crawlab.cn/Usage/SDK/CLI.html" target="_blank" style="color: #409EFF">CLI Tool</a>.')}],tourCallbacks:{onStop:function(){e.$utils.tour.finishTour("spider-list")},onPreviousStep:function(t){e.$utils.tour.prevStep("spider-list",t)},onNextStep:function(t){e.$utils.tour.nextStep("spider-list",t)}},tourAddSteps:[{target:"#tab-customized",content:this.$t("<strong>Customized Spider</strong> is a highly customized spider, which is able to run on any programming language and any web crawler framework."),params:{placement:"bottom",highlight:!1}},{target:"#tab-configurable",content:this.$t("<strong>Configurable Spider</strong> is a spider defined by config data, aimed at streamlining spider development and improving dev efficiency."),params:{placement:"bottom",highlight:!1}},{target:"#spider-name",content:this.$t("Unique identifier for the spider"),params:{placement:"right"}},{target:"#display-name",content:this.$t("How the spider is displayed on Crawlab"),params:{placement:"right"}},{target:"#cmd",content:this.$t("A shell command to be executed when the spider is triggered to run (only available for <strong>Customized Spider</strong>"),params:{placement:"right"}},{target:"#col",content:this.$t("Where the results are stored in the database"),params:{placement:"right"}},{target:"#upload",content:this.$t("Upload a zip file containing all spider files to create the spider (only available for <strong>Customized Spider</strong>)"),params:{placement:"right"}},{target:"#template",content:this.$t("The spider template to create from (only available for <strong>Configurable Spider</strong>)"),params:{placement:"right"}},{target:"#add",content:this.$t("Click to confirm to add the spider"),params:{placement:"right"}}],tourAddCallbacks:{onStop:function(){e.$utils.tour.finishTour("spider-list-add")},onPreviousStep:function(t){7===t&&(e.activeTabName="customized"),e.$utils.tour.prevStep("spider-list-add",t)},onNextStep:function(t){6===t&&(e.activeTabName="configurable"),e.$utils.tour.nextStep("spider-list-add",t)}},handle:void 0,activeSpiderTaskStatus:"running",selectedSpiders:[],isStopLoading:!1,isRemoveLoading:!1,isMultiple:!1,copyDialogVisible:!1,form:{projectId:null}}},computed:Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])(Object(n["a"])({},Object(o["c"])("spider",["importForm","spiderList","spiderForm","spiderTotal","templateList"])),Object(o["c"])("task",["batchCrawlList"])),Object(o["b"])("user",["userInfo","token"])),Object(o["c"])("lang",["lang"])),Object(o["c"])("project",["projectList"])),Object(o["c"])("node",["nodeList"])),Object(o["c"])("dataSource",["dataSourceList"])),{},{uploadForm:function(){return{name:this.spiderForm.name,display_name:this.spiderForm.display_name,col:this.spiderForm.col,cmd:this.spiderForm.cmd}},columns:function(){var e=[];return e.push({name:"display_name",label:"Name",width:"160",align:"left",sortable:!0}),e.push({name:"type",label:"Spider Type",width:"120",sortable:!0}),e.push({name:"project_name",label:"Project",width:"120"}),e.push({name:"is_long_task",label:"Is Long Task",width:"80"}),e.push({name:"is_scrapy",label:"Is Scrapy",width:"80"}),e.push({name:"latest_tasks",label:"Latest Tasks",width:"180"}),e.push({name:"last_status",label:"Last Status",width:"120"}),e.push({name:"last_run_ts",label:"Last Run",width:"140"}),e.push({name:"update_ts",label:"Update Time",width:"140"}),e.push({name:"create_ts",label:"Create Time",width:"140"}),e.push({name:"username",label:"Owner",width:"100"}),e.push({name:"remark",label:"Remark",width:"140"}),e},activeNodeList:function(){return this.nodeList.filter((function(e){return"online"===e.status}))},activeSpiderIds:function(){return this.selectedSpiders.map((function(e){return e._id}))}}),created:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,e.$store.dispatch("project/getProjectList");case 2:return e.$route.params.project_id&&(e.filter.project_id=e.$route.params.project_id),t.next=5,e.$store.dispatch("node/getNodeList");case 5:return t.next=7,e.getList();case 7:return t.next=9,e.$store.dispatch("spider/getAllSpiderList");case 9:return t.next=11,e.$store.dispatch("spider/getTemplateList");case 11:return e.handle=setInterval((function(){e.getList()}),15e3),t.next=14,e.$store.dispatch("dataSource/getDataSourceList");case 14:case"end":return t.stop()}}),t)})))()},mounted:function(){var e=this,t=this;this.$nextTick((function(){t.$store.commit("spider/SET_SPIDER_FORM",e.spiderForm)})),this.$utils.tour.isFinishedTour("spider-list")||this.$utils.tour.startTour(this,"spider-list")},destroyed:function(){clearInterval(this.handle)},methods:{onSpiderTypeChange:function(e){this.filter.type=e,this.getList()},onPageSizeChange:function(e){this.pagination.pageSize=e,this.getList()},onPageNumChange:function(e){this.pagination.pageNum=e,this.getList()},onSearch:function(){this.getList()},onAdd:function(){var e=this,t="000000000000000000000000";this.filter.project_id&&(t=this.filter.project_id),this.$store.commit("spider/SET_SPIDER_FORM",{project_id:t,data_source_id:"000000000000000000000000",template:this.templateList[0]}),this.addDialogVisible=!0,setTimeout((function(){e.$utils.tour.isFinishedTour("spider-list-add")||e.$utils.tour.startTour(e,"spider-list-add")}),300)},onAddConfigurable:function(){var e=this;this.$refs["addConfigurableForm"].validate(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e.$store.dispatch("spider/addConfigSpider");case 5:s=t.sent,t.next=12;break;case 8:return t.prev=8,t.t0=t["catch"](2),e.$message.error(e.$t("Something wrong happened")),t.abrupt("return");case 12:e.$router.push("/spiders/".concat(s.data.data._id)),e.getList(),e.$st.sendEv("爬虫列表","添加爬虫","可配置爬虫");case 15:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())},onAddCustomized:function(){var e=this;this.$refs["addCustomizedForm"].validate(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){var s;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,t.next=5,e.$store.dispatch("spider/addSpider");case 5:s=t.sent,t.next=12;break;case 8:return t.prev=8,t.t0=t["catch"](2),e.$message.error(e.$t("Something wrong happened")),t.abrupt("return");case 12:e.$router.push("/spiders/".concat(s.data.data._id)),e.getList(),e.$st.sendEv("爬虫列表","添加爬虫","自定义爬虫");case 15:case"end":return t.stop()}}),t,null,[[2,8]])})));return function(e){return t.apply(this,arguments)}}())},onRefresh:function(){this.getList(),this.$st.sendEv("爬虫列表","刷新")},onSubmit:function(){var e=this,t=this,i="spiderForm";this.$refs[i].validate((function(i){if(!i)return!1;e.isEditMode?t.$store.dispatch("spider/editSpider"):t.$store.dispatch("spider/addSpider"),t.dialogVisible=!1}))},onCancel:function(){this.$store.commit("spider/SET_SPIDER_FORM",{}),this.dialogVisible=!1},onDialogClose:function(){this.$store.commit("spider/SET_SPIDER_FORM",{}),this.dialogVisible=!1},onAddDialogClose:function(){this.addDialogVisible=!1},onEdit:function(e){this.isEditMode=!0,this.$store.commit("spider/SET_SPIDER_FORM",e),this.dialogVisible=!0},onRemove:function(e,t){var i=this;t.stopPropagation(),this.$confirm(this.$t("Are you sure to delete this spider?"),this.$t("Notification"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return t.next=2,i.$store.dispatch("spider/deleteSpider",e._id);case 2:return i.$message({type:"success",message:i.$t("Deleted successfully")}),t.next=5,i.getList();case 5:i.$st.sendEv("爬虫列表","删除爬虫");case 6:case"end":return t.stop()}}),t)}))))},onCrawl:function(e,t){t.stopPropagation(),this.crawlConfirmDialogVisible=!0,this.activeSpiderId=e._id,this.$st.sendEv("爬虫列表","点击运行")},onCrawlConfirm:function(){var e=this;setTimeout((function(){e.getList()}),1e3)},onBatchCrawlConfirm:function(){var e=this;setTimeout((function(){e.getList()}),1e3)},onCopy:function(e,t){t.stopPropagation(),this.copyDialogVisible=!0,this.activeSpiderId=e._id,this.$st.sendEv("爬虫列表","点击复制")},onCopyConfirm:function(){var e=this;setTimeout((function(){e.getList()}),1e3)},onView:function(e,t){t.stopPropagation(),this.$router.push("/spiders/"+e._id),this.$st.sendEv("爬虫列表","查看爬虫")},onImport:function(){var e=this;this.$refs.importForm.validate((function(t){t&&(e.importLoading=!0,e.$store.dispatch("spider/importGithub").then((function(t){e.$message.success("Import repo successfully"),e.getList()}))["catch"]((function(t){e.$message.error(t.data.error)}))["finally"]((function(){e.dialogVisible=!1,e.importLoading=!1})))})),this.$st.sendEv("爬虫列表","导入爬虫")},openImportDialog:function(){this.dialogVisible=!0},isShowRun:function(e){return!this.isCustomized(e)||!!e.cmd},isCustomized:function(e){return"customized"===e.type},fetchSiteSuggestions:function(e,t){this.$request.get("/sites",{keyword:e,page_num:1,page_size:100}).then((function(e){var i=e.data.items.map((function(e){return e.value=e.name+" | "+e.domain,e}));t(i)}))},onUploadSuccess:function(e){var t=this;this.fileList=[],setTimeout((function(){t.getList()}),500),this.$message.success(this.$t("Uploaded spider files successfully")),this.$router.push("/spiders/".concat(e.data._id))},beforeUpload:function(e){var t=this;return new Promise((function(e,i){t.$refs["addCustomizedForm"].validate((function(t){t?e():i(new Error("form validation error"))}))}))},getTime:function(e){return!e||e.match("^0001")?"NA":c()(e).format("YYYY-MM-DD HH:mm:ss")},onRowClick:function(e,t,i){this.onView(e,i)},onSortChange:function(e){e.column;var t=e.prop,i=e.order;this.sort.sortKey=i?t:"",this.sort.sortDirection=i,this.getList()},onClickTab:function(e){this.filter.type=e.name,this.getList()},getList:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return i={page_num:e.pagination.pageNum,page_size:e.pagination.pageSize,sort_key:e.sort.sortKey,sort_direction:e.sort.sortDirection,keyword:e.filter.keyword,type:e.filter.type,project_id:e.filter.project_id,owner_type:e.filter.owner_type},t.next=3,e.$store.dispatch("spider/getSpiderList",i);case 3:e.updateActiveSpider();case 4:case"end":return t.stop()}}),t)})))()},getTasksByStatus:function(e,t){return e.latest_tasks?e.latest_tasks.filter((function(e){return e.status===t})):[]},getTaskCountByStatus:function(e,t){return this.getTasksByStatus(e,t).length},updateActiveSpider:function(){if(this.activeSpider)for(var e=0;e<this.spiderList.length;e++){var t=this.spiderList[e];this.activeSpider._id===t._id&&(this.activeSpider=t)}},onViewRunningTasks:function(e,t){t.stopPropagation(),this.activeSpider=e,this.isRunningTasksDialogVisible=!0},getTasksByNode:function(e){var t=this;return this.activeSpider.latest_tasks?this.activeSpider.latest_tasks.filter((function(i){return i.node_id===e._id&&i.status===t.activeSpiderTaskStatus})).map((function(e){return e=JSON.parse(JSON.stringify(e)),e.create_ts=e.create_ts.match("^0001")?"NA":c()(e.create_ts).format("YYYY-MM-DD HH:mm:ss"),e.start_ts=e.start_ts.match("^0001")?"NA":c()(e.start_ts).format("YYYY-MM-DD HH:mm:ss"),e.finish_ts=e.finish_ts.match("^0001")?"NA":c()(e.finish_ts).format("YYYY-MM-DD HH:mm:ss"),e})):[]},onViewTask:function(e){this.$router.push("/tasks/".concat(e._id)),this.$st.sendEv("爬虫列表","任务列表","查看任务")},onStop:function(e,t){var i=this;return Object(r["a"])(regeneratorRuntime.mark((function s(){var a;return regeneratorRuntime.wrap((function(s){while(1)switch(s.prev=s.next){case 0:return t.stopPropagation(),s.next=3,i.$store.dispatch("task/cancelTask",e._id);case 3:a=s.sent,a.data.error||(i.$message.success('Task "'.concat(e._id,'" has been sent signal to stop')),i.getList()),i.$st.sendEv("爬虫列表","任务列表","停止任务");case 6:case"end":return s.stop()}}),s)})))()},onIsScrapy:function(e){e&&(this.spiderForm.cmd="scrapy crawl")},onSpiderSelect:function(e){this.selectedSpiders=e},onRemoveSelectedSpiders:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm(e.$t("Are you sure to delete selected items?"),e.$t("Notification"),{confirmButtonText:e.$t("Confirm"),cancelButtonText:e.$t("Cancel"),type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isRemoveLoading=!0,t.prev=1,t.next=4,e.$request["delete"]("/spiders",{spider_ids:e.selectedSpiders.map((function(e){return e._id}))});case 4:if(i=t.sent,i.data.error){t.next=10;break}return e.$message.success("Deleted successfully"),e.$refs["table"].clearSelection(),t.next=10,e.getList();case 10:return t.prev=10,e.isRemoveLoading=!1,t.finish(10);case 13:e.$st.sendEv("爬虫列表","批量删除爬虫");case 14:case"end":return t.stop()}}),t,null,[[1,,10,13]])}))));case 1:case"end":return t.stop()}}),t)})))()},onStopSelectedSpiders:function(){var e=this;return Object(r["a"])(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:e.$confirm(e.$t("Are you sure to stop selected items?"),e.$t("Notification"),{confirmButtonText:e.$t("Confirm"),cancelButtonText:e.$t("Cancel"),type:"warning"}).then(Object(r["a"])(regeneratorRuntime.mark((function t(){var i;return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:return e.isStopLoading=!0,t.prev=1,t.next=4,e.$request.post("/spiders-cancel",{spider_ids:e.selectedSpiders.map((function(e){return e._id}))});case 4:if(i=t.sent,i.data.error){t.next=9;break}return e.$message.success("Sent signals to cancel selected tasks"),t.next=9,e.getList();case 9:return t.prev=9,e.isStopLoading=!1,t.finish(9);case 12:e.$st.sendEv("爬虫列表","批量停止爬虫");case 13:case"end":return t.stop()}}),t,null,[[1,,9,12]])}))));case 1:case"end":return t.stop()}}),t)})))()},onBatchCrawl:function(){if(this.$store.commit("task/SET_BATCH_CRAWL_LIST",this.selectedSpiders.map((function(e){return{spider_id:e._id,run_type:"random",param:"",scrapy_log_level:"INFO"}}))),this.batchCrawlList.length<10)for(var e=this.batchCrawlList.length;e<10;e++)this.batchCrawlList.push({spider_id:"",run_type:"random",param:"",scrapy_log_level:"INFO"});this.batchCrawlDialogVisible=!0,this.isMultiple=!0,this.$st.sendEv("爬虫列表","点击批量运行")},onCrawlConfirmDialogClose:function(){this.crawlConfirmDialogVisible=!1,this.isMultiple=!1},onBatchCrawlDialogClose:function(){this.batchCrawlDialogVisible=!1,this.isMultiple=!1},isDisabled:function(e){return e.is_public&&e.username!==this.userInfo.username&&"admin"!==this.userInfo.role},onSetProjects:function(){this.setProjectsVisible=!0,this.isMultiple=!0,this.form.projectId=null},onSetProjectsConfirm:function(){var e=this;this.$refs["set-projects-form"].validate(function(){var t=Object(r["a"])(regeneratorRuntime.mark((function t(i){return regeneratorRuntime.wrap((function(t){while(1)switch(t.prev=t.next){case 0:if(i){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,e.$store.dispatch("spider/setProjects",{projectId:e.form.projectId,spiderIds:e.selectedSpiders.map((function(e){return e._id}))});case 4:return e.setProjectsVisible=!1,e.isMultiple=!1,t.next=8,e.getList();case 8:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}()),this.$st.sendEv("爬虫列表","批量设置项目")}}},L=x,j=(i("c76d"),i("30a6"),Object(h["a"])(L,s,a,!1,null,"562997ea",null));t["default"]=j.exports},c734:function(e,t,i){"use strict";var s=i("e882"),a=i.n(s);a.a},c76d:function(e,t,i){"use strict";var s=i("f6b5"),a=i.n(s);a.a},e3c4:function(e,t,i){},e882:function(e,t,i){},f6b5:function(e,t,i){}}]);
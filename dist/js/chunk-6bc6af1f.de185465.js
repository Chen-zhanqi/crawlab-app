(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-6bc6af1f"],{3264:function(t,e,s){},5184:function(t,e,s){"use strict";var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"legend"},[s("el-tag",{attrs:{type:"primary",size:"small"}},[s("i",{staticClass:"el-icon-loading"}),t._v(" "+t._s(t.$t("Pending"))+" ")]),s("el-tag",{attrs:{type:"warning",size:"small"}},[s("i",{staticClass:"el-icon-loading"}),t._v(" "+t._s(t.$t("Running"))+" ")]),s("el-tag",{attrs:{type:"success",size:"small"}},[s("i",{staticClass:"el-icon-check"}),t._v(" "+t._s(t.$t("Finished"))+" ")]),s("el-tag",{attrs:{type:"danger",size:"small"}},[s("i",{staticClass:"el-icon-error"}),t._v(" "+t._s(t.$t("Error"))+" ")]),s("el-tag",{attrs:{type:"info",size:"small"}},[s("i",{staticClass:"el-icon-video-pause"}),t._v(" "+t._s(t.$t("Cancelled"))+" ")]),s("el-tag",{attrs:{type:"danger",size:"small"}},[s("i",{staticClass:"el-icon-warning"}),t._v(" "+t._s(t.$t("Abnormal"))+" ")])],1)},a=[],i={name:"StatusLegend"},l=i,o=(s("c734"),s("9ca4")),r=Object(o["a"])(l,n,a,!1,null,"57985e9e",null);e["a"]=r.exports},"5af5":function(t,e,s){"use strict";var n=s("3264"),a=s.n(n);a.a},af9b:function(t,e,s){},b2914:function(t,e,s){"use strict";s.r(e);var n=function(){var t=this,e=t.$createElement,s=t._self._c||e;return s("div",{staticClass:"app-container"},[s("v-tour",{attrs:{name:"task-list",steps:t.tourSteps,callbacks:t.tourCallbacks,options:t.$utils.tour.getOptions(!0)}}),s("el-card",{staticStyle:{"border-radius":"0"}},[s("div",{staticClass:"filter"},[s("div",{staticClass:"left"},[s("el-form",{staticClass:"filter-form",attrs:{model:t.filter,"label-width":"100px","label-position":"right",inline:""}},[s("el-form-item",{attrs:{label:t.$t("Type")}},[s("el-button-group",[s("el-button",{attrs:{size:"small",type:"spider"===t.filter.type?"primary":""},on:{click:function(e){return t.onClickType("spider")}}},[t._v(" "+t._s(t.$t("Spider Tasks"))+" ")]),s("el-button",{attrs:{size:"small",type:"system"===t.filter.type?"primary":""},on:{click:function(e){return t.onClickType("system")}}},[t._v(" "+t._s(t.$t("System Tasks"))+" ")])],1)],1),s("el-form-item",{attrs:{prop:"node_id",label:t.$t("Node")}},[s("el-select",{attrs:{size:"small",placeholder:t.$t("Node")},on:{change:t.onFilterChange},model:{value:t.filter.node_id,callback:function(e){t.$set(t.filter,"node_id",e)},expression:"filter.node_id"}},[s("el-option",{attrs:{value:"",label:t.$t("All")}}),t._l(t.nodeList,(function(t){return s("el-option",{key:t._id,attrs:{value:t._id,label:t.name}})}))],2)],1),s("el-form-item",{attrs:{prop:"spider_id",label:t.$t("Spider")}},[s("el-select",{attrs:{size:"small",placeholder:t.$t("Spider"),disabled:t.isFilterSpiderDisabled},on:{change:t.onFilterChange},model:{value:t.filter.spider_id,callback:function(e){t.$set(t.filter,"spider_id",e)},expression:"filter.spider_id"}},[s("el-option",{attrs:{value:"",label:t.$t("All")}}),t._l(t.allSpiderList,(function(t){return s("el-option",{key:t._id,attrs:{value:t._id,label:t.name}})}))],2)],1),s("el-form-item",{attrs:{prop:"status",label:t.$t("Status")}},[s("el-select",{attrs:{size:"small",placeholder:t.$t("Status")},on:{change:t.onFilterChange},model:{value:t.filter.status,callback:function(e){t.$set(t.filter,"status",e)},expression:"filter.status"}},[s("el-option",{attrs:{value:"",label:t.$t("All")}}),s("el-option",{attrs:{value:"pending",label:t.$t("Pending")}}),s("el-option",{attrs:{value:"running",label:t.$t("Running")}}),s("el-option",{attrs:{value:"finished",label:t.$t("Finished")}}),s("el-option",{attrs:{value:"error",label:t.$t("Error")}}),s("el-option",{attrs:{value:"cancelled",label:t.$t("Cancelled")}}),s("el-option",{attrs:{value:"abnormal",label:t.$t("Abnormal")}})],1)],1)],1)],1),s("div",{staticClass:"right"},[t.selectedRunningTasks.length>0?s("el-button",{staticClass:"btn-stop",attrs:{icon:"el-icon-video-pause",size:"small",type:"info"},on:{click:t.onStopMultipleTask}},[t._v(" "+t._s(t.$t("Cancel"))+" ")]):t._e(),t.selectedTasks.length>0?s("el-button",{staticClass:"btn-restart",attrs:{icon:"el-icon-refresh",size:"small",type:"warning"},on:{click:t.onRestartMultipleTask}},[t._v(" "+t._s(t.$t("Restart"))+" ")]):t._e(),t.selectedTasks.length>0?s("el-button",{staticClass:"btn-delete",attrs:{icon:"el-icon-delete",size:"small",type:"danger"},on:{click:t.onRemoveMultipleTask}},[t._v(" "+t._s(t.$t("Remove"))+" ")]):t._e()],1)]),s("status-legend"),s("el-table",{ref:"table",staticClass:"table",attrs:{data:t.filteredTableData,"header-cell-style":{background:"rgb(48, 65, 86)",color:"white"},border:"","row-key":"_id"},on:{"row-click":t.onRowClick,"selection-change":t.onSelectionChange}},[s("el-table-column",{attrs:{type:"selection",width:"45",align:"center","reserve-selection":""}}),t._l(t.columns,(function(e){return["spider_name"===e.name?s("el-table-column",{key:e.name,attrs:{label:t.$t(e.label),sortable:e.sortable,align:e.align},scopedSlots:t._u([{key:"default",fn:function(n){return[s("a",{staticClass:"a-tag",attrs:{href:"javascript:"},on:{click:function(e){return t.onClickSpider(n.row)}}},[t._v(t._s(n.row[e.name]))])]}}],null,!0)}):e.name.match(/_ts$/)?s("el-table-column",{key:e.name,attrs:{label:t.$t(e.label),sortable:e.sortable,align:e.align,width:e.width},scopedSlots:t._u([{key:"default",fn:function(s){return[t._v(" "+t._s(t.getTime(s.row[e.name]))+" ")]}}],null,!0)}):"wait_duration"===e.name?s("el-table-column",{key:e.name,attrs:{label:t.$t(e.label),sortable:e.sortable,align:e.align,width:e.width},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getWaitDuration(e.row))+" ")]}}],null,!0)}):"runtime_duration"===e.name?s("el-table-column",{key:e.name,attrs:{label:t.$t(e.label),sortable:e.sortable,align:e.align,width:e.width},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getRuntimeDuration(e.row))+" ")]}}],null,!0)}):"total_duration"===e.name?s("el-table-column",{key:e.name,attrs:{label:t.$t(e.label),sortable:e.sortable,align:e.align,width:e.width},scopedSlots:t._u([{key:"default",fn:function(e){return[t._v(" "+t._s(t.getTotalDuration(e.row))+" ")]}}],null,!0)}):"node_name"===e.name?s("el-table-column",{key:e.name,attrs:{label:t.$t(e.label),sortable:e.sortable,align:e.align,width:e.width},scopedSlots:t._u([{key:"default",fn:function(n){return[s("a",{staticClass:"a-tag",attrs:{href:"javascript:"},on:{click:function(e){return t.onClickNode(n.row)}}},[t._v(t._s(n.row[e.name]))])]}}],null,!0)}):"status"===e.name?s("el-table-column",{key:e.name,attrs:{label:t.$t(e.label),sortable:e.sortable,align:e.align,width:e.width},scopedSlots:t._u([{key:"default",fn:function(n){return[s("status-tag",{attrs:{status:n.row[e.name]}}),n.row.error_log_count>0?[s("el-tooltip",{attrs:{content:t.$t("Log Errors")+": "+n.row.error_log_count,placement:"top"}},[s("el-tag",{staticStyle:{"margin-left":"10px"},attrs:{type:"danger"}},[s("i",{staticClass:"el-icon-warning"}),s("i",{staticClass:"el-icon-tickets"})])],1)]:t._e()]}}],null,!0)}):s("el-table-column",{key:e.name,attrs:{property:e.name,label:t.$t(e.label),sortable:e.sortable,align:e.align,width:e.width}})]})),s("el-table-column",{attrs:{label:t.$t("Action"),align:"left",fixed:"right",width:"200px"},scopedSlots:t._u([{key:"default",fn:function(e){return[s("el-tooltip",{attrs:{content:t.$t("View"),placement:"top"}},[s("el-button",{attrs:{type:"primary",icon:"el-icon-search",size:"mini"},on:{click:function(s){return t.onView(e.row)}}})],1),s("el-tooltip",{attrs:{content:t.$t("Restart"),placement:"top"}},[s("el-button",{attrs:{type:"warning",icon:"el-icon-refresh",size:"mini"},on:{click:function(s){return t.onRestart(e.row,s)}}})],1),s("el-tooltip",{attrs:{content:t.$t("Remove"),placement:"top"}},[s("el-button",{attrs:{type:"danger",icon:"el-icon-delete",size:"mini"},on:{click:function(s){return t.onRemove(e.row,s)}}})],1),["pending","running"].includes(e.row.status)?s("el-tooltip",{attrs:{content:t.$t("Stop"),placement:"top"}},[s("el-button",{attrs:{type:"info",icon:"el-icon-video-pause",size:"mini"},on:{click:function(s){return t.onStop(e.row,s)}}})],1):t._e()]}}])})],2),s("div",{staticClass:"pagination"},[s("el-pagination",{attrs:{"current-page":t.pageNum,"page-sizes":[10,20,50,100],"page-size":t.pageSize,layout:"sizes, prev, pager, next",total:t.taskListTotalCount},on:{"update:currentPage":function(e){t.pageNum=e},"update:current-page":function(e){t.pageNum=e},"update:pageSize":function(e){t.pageSize=e},"update:page-size":function(e){t.pageSize=e},"current-change":t.onPageChange,"size-change":t.onPageChange}})],1)],1)],1)},a=[],i=(s("dbb3"),s("b130"),s("ecb4"),s("2eeb"),s("08d5"),s("053b"),s("e35a"),s("f4e3"),s("1fb3"),s("e793")),l=s("9f3a"),o=s("1d45"),r=s.n(o),c=s("c91b"),u=s("5184"),d={name:"TaskList",components:{StatusLegend:u["a"],StatusTag:c["a"]},data:function(){var t=this;return{handle:void 0,isEditMode:!1,dialogVisible:!1,columns:[{name:"node_name",label:"Node",width:"120"},{name:"spider_name",label:"Spider",width:"120"},{name:"status",label:"Status",width:"180"},{name:"param",label:"Parameters",width:"120"},{name:"start_ts",label:"Start Time",width:"100"},{name:"finish_ts",label:"Finish Time",width:"100"},{name:"wait_duration",label:"Wait Duration (sec)",align:"right"},{name:"runtime_duration",label:"Runtime Duration (sec)",align:"right"},{name:"total_duration",label:"Total Duration (sec)",width:"80",align:"right"},{name:"result_count",label:"Results Count",width:"80"},{name:"username",label:"Owner",width:"100"}],selectedTasks:[],tourSteps:[{target:".filter-form",content:this.$t("You can filter tasks from this area.")},{target:".table",content:this.$t("This is a list of spider tasks executed sorted in a time descending order.")},{target:".table .el-table__body-wrapper tr:nth-child(1)",content:this.$t("Click the row to or the view button to view the task detail.")},{target:".table tr td:nth-child(1)",content:this.$t("Tick and select the tasks you would like to delete in batches."),params:{placement:"right"}},{target:".btn-delete",content:this.$t("Click this button to delete selected tasks."),params:{placement:"left"}}],tourCallbacks:{onStop:function(){t.$utils.tour.finishTour("task-list")},onPreviousStep:function(e){t.$utils.tour.prevStep("task-list",e)},onNextStep:function(e){t.$utils.tour.nextStep("task-list",e)}},isFilterSpiderDisabled:!1}},computed:Object(i["a"])(Object(i["a"])(Object(i["a"])(Object(i["a"])({},Object(l["c"])("task",["filter","taskList","taskListTotalCount","taskForm"])),Object(l["c"])("spider",["allSpiderList"])),Object(l["c"])("node",["nodeList"])),{},{pageNum:{get:function(){return this.$store.state.task.pageNum},set:function(t){this.$store.commit("task/SET_PAGE_NUM",t)}},pageSize:{get:function(){return this.$store.state.task.pageSize},set:function(t){this.$store.commit("task/SET_PAGE_SIZE",t)}},filteredTableData:function(){var t=this;return this.taskList.map((function(t){return t})).sort((function(t,e){return t.create_ts<e.create_ts?1:-1})).filter((function(e){if(!t.filter.keyword)return!0;for(var s=0;s<t.columns.length;s++){var n=t.columns[s].name;if(e[n]&&e[n].toLowerCase().indexOf(t.filter.keyword.toLowerCase())>-1)return!0}return!1}))},selectedRunningTasks:function(){return this.selectedTasks.filter((function(t){return["pending","running"].includes(t.status)}))}}),created:function(){this.$store.dispatch("task/getTaskList"),this.$store.dispatch("spider/getAllSpiderList"),this.$store.dispatch("node/getNodeList")},mounted:function(){var t=this;this.handle=setInterval((function(){t.$store.dispatch("task/getTaskList")}),5e3),this.$utils.tour.isFinishedTour("task-list")||this.$utils.tour.startTour(this,"task-list")},destroyed:function(){clearInterval(this.handle)},methods:{onSearch:function(t){},onRefresh:function(){this.$store.dispatch("task/getTaskList"),this.$st.sendEv("任务列表","搜索")},onRestartMultipleTask:function(){var t=this;this.$confirm(this.$t("Are you sure to restart these tasks"),this.$t("Notification"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){var e=t.selectedTasks.map((function(t){return t._id}));t.$store.dispatch("task/restartTaskMultiple",e).then((function(e){if("ok"===e.data.status)return t.$message({type:"success",message:t.$t("Restarted successfully")}),t.$store.dispatch("task/getTaskList"),void t.$refs["table"].clearSelection();t.$message({type:"error",message:e.data.error})})),t.$st.sendEv("任务列表","批量重启任务")}))["catch"]((function(){}))},onRemoveMultipleTask:function(){var t=this;this.$confirm(this.$t("Are you sure to delete these tasks"),this.$t("Notification"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){var e=t.selectedTasks.map((function(t){return t._id}));t.$store.dispatch("task/deleteTaskMultiple",e).then((function(e){if("ok"===e.data.status)return t.$message({type:"success",message:t.$t("Deleted successfully")}),t.$store.dispatch("task/getTaskList"),void t.$refs["table"].clearSelection();t.$message({type:"error",message:e.data.error})})),t.$st.sendEv("任务列表","批量删除任务")}))["catch"]((function(){}))},onStopMultipleTask:function(){var t=this;this.$confirm(this.$t("Are you sure to stop these tasks"),this.$t("Notification"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){var e=t.selectedRunningTasks.map((function(t){return t._id}));t.$store.dispatch("task/cancelTaskMultiple",e).then((function(e){if("ok"===e.data.status)return t.$message({type:"success",message:t.$t("Stopped successfully")}),t.$store.dispatch("task/getTaskList"),void t.$refs["table"].clearSelection();t.$message({type:"error",message:e.data.error})})),t.$st.sendEv("任务列表","批量停止任务")}))["catch"]((function(){}))},onRemove:function(t,e){var s=this;e.stopPropagation(),this.$confirm(this.$t("Are you sure to delete this task?"),this.$t("Notification"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){s.$store.dispatch("task/deleteTask",t._id).then((function(){s.$message({type:"success",message:s.$t("Deleted successfully")})})),s.$st.sendEv("任务列表","删除任务")}))},onRestart:function(t,e){var s=this;e.stopPropagation(),this.$confirm(this.$t("Are you sure to restart this task?"),this.$t("Notification"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){s.$store.dispatch("task/restartTask",t._id).then((function(){s.$message({type:"success",message:s.$t("Restarted successfully")})})),s.$st.sendEv("任务列表","重新开始任务")}))},onStop:function(t,e){var s=this;e.stopPropagation(),this.$confirm(this.$t("Are you sure to stop this task?"),this.$t("Notification"),{confirmButtonText:this.$t("Confirm"),cancelButtonText:this.$t("Cancel"),type:"warning"}).then((function(){s.$store.dispatch("task/cancelTask",t._id).then((function(){s.$message({type:"success",message:s.$t("Stopped successfully")}),s.$store.dispatch("task/getTaskList")})),s.$st.sendEv("任务列表","停止任务")}))},onView:function(t){this.$router.push("/tasks/".concat(t._id)),this.$st.sendEv("任务列表","查看任务")},onClickSpider:function(t){this.$router.push("/spiders/".concat(t.spider_id)),this.$st.sendEv("任务列表","点击爬虫详情")},onClickNode:function(t){this.$router.push("/nodes/".concat(t.node_id)),this.$st.sendEv("任务列表","点击节点详情")},onPageChange:function(){var t=this;setTimeout((function(){t.$store.dispatch("task/getTaskList")}),0)},getTime:function(t){return t.match("^0001")?"NA":r()(t).format("YYYY-MM-DD HH:mm:ss")},getWaitDuration:function(t){return t.start_ts.match("^0001")?"NA":r()(t.start_ts).diff(t.create_ts,"second")},getRuntimeDuration:function(t){return t.finish_ts.match("^0001")?"NA":r()(t.finish_ts).diff(t.start_ts,"second")},getTotalDuration:function(t){return t.finish_ts.match("^0001")?"NA":r()(t.finish_ts).diff(t.create_ts,"second")},onRowClick:function(t,e,s){s.label!==this.$t("Action")&&this.onView(t)},onSelectionChange:function(t){this.selectedTasks=t},onFilterChange:function(){this.$store.dispatch("task/getTaskList"),this.$st.sendEv("任务列表","筛选任务")},onClickType:function(t){this.$set(this.filter,"type",t),this.$store.dispatch("task/getTaskList"),this.$st.sendEv("任务列表","选择类别",t)}}},p=d,f=(s("e9c8"),s("5af5"),s("9ca4")),h=Object(f["a"])(p,n,a,!1,null,"bef18b20",null);e["default"]=h.exports},c734:function(t,e,s){"use strict";var n=s("e882"),a=s.n(n);a.a},e882:function(t,e,s){},e9c8:function(t,e,s){"use strict";var n=s("af9b"),a=s.n(n);a.a}}]);